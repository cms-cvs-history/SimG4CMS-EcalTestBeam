process PROD  = 
{

    service = MessageLogger
	{
      	untracked vstring destinations = {"cout"}

      	untracked vstring categories = {  
               "CaloSim",
				"EcalGeom",
				"EcalSim",
				"EcalTBInfo",
				"EcalTBHodo",
                "EcalCoder",
                "EcalDigi",
				"VertexGenerator"}
                untracked vstring debugModules = { "SimEcalEventHeader" }
     	untracked PSet cout = {untracked string threshold = "DEBUG"
#     	untracked PSet cout = {untracked string threshold = "INFO"
#				untracked PSet INFO     = { untracked int32 limit = -1 }
#				untracked PSet DEBUG    = { untracked int32 limit = 0 }
#				untracked PSet CaloSim  = { untracked int32 limit = 1000000 }
#				untracked PSet EcalGeom = { untracked int32 limit = 1000000 }
#				untracked PSet EcalSim  = { untracked int32 limit = 1000000 }
#				untracked PSet EcalTBInfo = { untracked int32 limit = 1000000 }
#				untracked PSet EcalTBHodo = { untracked int32 limit = 1000000 }
#				untracked PSet EcalCoder = { untracked int32 limit = 1000000 }
#				untracked PSet EcalDigi = { untracked int32 limit = 1000000 }
#				untracked PSet VertexGenerator = { untracked int32 limit = 1000000}
                }
   }
  	
	   
   # service = Timing {}

   service = RandomNumberGeneratorService
   {
      untracked uint32 sourceSeed = 98765
      PSet moduleSeeds =
      {
         untracked uint32 VtxSmeared = 12345
      }
   }
      
   include "SimG4CMS/EcalTestBeam/test/data/crystal1104.cff"

   # flat random E-gun
   #
   source = FlatRandomEGunSource
   {
      untracked int32 maxEvents = 100
      untracked PSet PGunParameters =
      {
         # you can request more than 1 particle
         untracked vint32 PartID = {11}
         using common_beam_direction_parameters
         untracked double MinE   = 29.999
         untracked double MaxE   = 30.001
      }
      untracked int32 Verbosity = 0 # set to 1 (or greater)  for printouts
   }

   module VtxSmeared = VertexGenerator 
   {
         string type = "IOMC/EventVertexGenerators/BeamProfileVertexGenerator"
         using common_beam_direction_parameters
         untracked double BeamSigmaX = 10.
         untracked double BeamSigmaY = 10.
         untracked bool GaussianProfile = false
   }

   #Geometry
   #   
   include "Geometry/EcalTestBeam/data/cmsEcalIdealTBGeometryXML.cfi"

   es_module = TrackerGeometricDetESModule {}

   # Magnetic Field
   #
   #include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
   
   # Geant4-based CMS Det.Simulation
   #
   include "SimG4CMS/EcalTestBeam/data/EcalTestBeamSimG4Object.cff"

   # Test Beam ECAL specific MC info
   #
   module SimEcalTBG4Object = EcalTBMCInfoProducer {
         FileInPath CrystalMapFile = "Geometry/EcalTestBeam/data/BarrelSM1CrystalCenterElectron120GeV.dat"
         untracked string moduleLabelVtx = 'VtxSmeared' 
         using common_beam_direction_parameters
   }

   # Test Beam ECAL hodoscope raw data simulation
   # 
   module SimEcalTBHodoscope = FakeTBHodoscopeRawInfoProducer {
         untracked string EcalTBInfoLabel = 'SimEcalTBG4Object'
   }

   # Test Beam ECAL hodoscope raw data simulation
   # 
   module SimEcalEventHeader = FakeTBEventHeaderProducer {
         untracked string EcalTBInfoLabel = 'SimEcalTBG4Object'
   }
		
   module mix = MixingModule {
#         secsource input = PoolRASource  {
#		 untracked vstring fileNames = {'file:simevent.root'}
#         string type = "poisson"
#         double averageNumber = 0
#         int32 minBunch = xxx
#         int32 maxBunch = xxx
#         int32 seed = 1234567
#         }
         int32 bunchspace = 25
   }

   include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"

   include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"
 
   # use trivial ESProducer for tests
   es_source = EcalTrivialConditionRetriever { }
 
   include "SimCalorimetry/EcalTestBeam/data/ecaldigi_testbeam.cfi"

   # Root/Pool output
   #
   module o1 = PoolOutputModule 
   { 
      untracked string fileName = "ecal_TB_simout.root" 
   }
   
   sequence doSimHits   = { VtxSmeared, SimG4Object }
   sequence doSimTB     = { SimEcalTBG4Object, SimEcalTBHodoscope, SimEcalEventHeader }
   sequence doEcalDigis = { mix, ecaldigi }
   path p1 = { doSimHits, doSimTB, doEcalDigis }
   endpath outpath = { o1 }
   
}		
